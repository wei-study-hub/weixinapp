<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; chaRset=utf-8" />
<meta name="author" content=" HouYanPing" /> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
	<title></title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/styles.css">
	<link rel="stylesheet" href="css/weui.css"/>
</head>
<body>
<form action="" id="studentInfo">
<div class="center ">
	<div class="texth4 h48">
		<span class="left mll">姓名</span>
		<span class="right">
			<input class="nob" type="text" name="studentName" id="studentName" placeholder="请填写学员姓名">
		</span>
	</div>
	<input type="hidden" id="userCode" name="userCode"></input>
	<input type="hidden" id="activityCode" name="activityCode"></input>
	<input type="hidden" id="sex"  name="sex"></input>
	<input type="hidden" id="studentCode" name="studentCode"></input>
	<div class="texth4 h48">
		<span class="left mll">性别</span>
		<span class="right sexx mll5">
			<em class="sex" id="boy">男</em>
			<em class="sex" id="girl">女</em>
		</span>
	</div>
	<div class="texth4 h48">
		<span class="left mll">年龄</span>
		<span class="right">
		<input class="nob" type="text" id="age" name="age"  placeholder="请填写学员年龄">
		</span>
	</div>
	<div class="texth4 nob h48">
		<span class="left mll" >学校</span>
		<span class="right">
			<input class="nob" type="text" id="school" name="school"  placeholder="请填写学员所在学校">
		</span>
	</div>
</div>
<div class="tijiao mt25">
<button type="button" id="save"  value="保存">保存</button>
</div>
</form>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript">
$('.sex').click(function(){
	$(this).addClass('sexed').siblings().removeClass('sexed');
	$("#sex").val($(".sexed").html());
})
$('#save').click(function(){

	
	if($('#studentName').val()==null||$('#studentName').val()==""){
		alert('学员姓名不能为空');
	}else{
	
		var strUrl = null;
		if($('#studentCode').val()==null||$('#studentCode').val()==''){
			strUrl = '/yuedong-weixin/student/client/1/addNewStudent'; // 新增
		}else{ 
			strUrl = '/yuedong-weixin/student/client/1/update';        //修改
		}
		
		$.ajax({
			url : ""+strUrl, // 提交的页面  
			data : $("#studentInfo").serialize(),
			method : "POST", // 设置请求类型为"POST"，默认为"GET"  
			dataType : 'json',
		    error : function() { // 设置表单提交出错  
				alert("执行出错");
			},
			success : function(result) {
				
				if(result.resultCode=='00')
				{
					window.location.href = 'studentinfo.html?userCode='+$('#userCode').val()+'&activityCode='+$('#activityCode').val();
				}else
				{
					alert("服务器异常");
				}
			},
			cache : false
		});
	}
})
$(function() {
	var strUrl = window.location.href;
	var indexof = strUrl.indexOf("?");
	var studentCode = null;
	if (indexof != -1) {
		if (strUrl.indexOf('&') != -1) {
			var s = strUrl.substr(strUrl.indexOf("?") + 1,
					strUrl.length)
			var str = s.split('&');
			for (var i = 0; i < str.length; i++) {
				if (str[i].indexOf("studentCode") != -1) {
					studentCode = str[i].substr(str[i].indexOf("=") + 1,
							str[i].length);
					
				}
				if (str[i].indexOf("activityCode") != -1) {
					activityCode = str[i].substr(str[i].indexOf("=") + 1,
							str[i].length);
					$('#activityCode').val(activityCode);
				}
			}
		} else {
			strUrl = strUrl.substr(strUrl.indexOf("=") + 1,
					strUrl.length);
			$('#activityCode').val(strUrl);
		}
	} else {
		strUrl = null;
	}
	if (null != studentCode) {
			$.ajax({
				url : "/yuedong-weixin/student/client/1/detail", // 提交的页面  
				data : {
					"studentCode":studentCode
				},
				method : "POST", // 设置请求类型为"POST"，默认为"GET"  
				dataType : 'json',
				error : function() { // 设置表单提交出错  
					alert("执行出错");
				},
				success : function(result) {
					if(result.resultCode=='00')
					{  
						$('#studentName').val(result.data['studentName']);
						$('#studentCode').val(result.data['studentCode']);
						$('#age').val(result.data['age']);
						if(result.data['sex']=="男"){
							$("#boy").addClass('sexed').siblings().removeClass('sexed');
							$("#sex").val($(".sexed").html());
						}else{
							$("#girl").addClass('sexed').siblings().removeClass('sexed');
							$("#sex").val($(".sexed").html());
						}
						
						$('#school').val(result.data['school']);
					    
				    }else
					{
						alert("服务器异常");
					}
				},
				cache : false
			});
		}
	})
</script>
</body>
</html>